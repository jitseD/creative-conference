---
import BaseLayout from "../../layouts/BaseLayout.astro";
import DetailTalkCard from "../../components/DetailTalkCard.astro";
import PrevNext from "../../components/PrevNext.astro";
import fetchApi from "../../lib/strapi";

export async function getStaticPaths() {
    const talks = await fetchApi({
        endpoint: "talks",
        wrappedByKey: "data",
        query: {
            populate: [
                "speaker",
                "speaker.image",
                "room",
                "room.venue",
                "day",
                "category",
            ],
        },
    });

    const paths = talks.map((talk, i) => ({
        params: { id: talk.attributes.slug.toString() },
        props: {
            talk,
            next: i < talks.length - 1 ? talks[i + 1] : null,
            prev: i > 0 ? talks[i - 1] : null,
        },
    }));

    return paths;
}

const { talk, prev, next } = Astro.props;
---

<BaseLayout pageTitle={talk.attributes.title}>
    <DetailTalkCard talk={talk} />
    <section>
        <div class="category">
            <a
                class="button"
                href={`${import.meta.env.BASE_URL}/category/${
                    talk.attributes.category.data.attributes.slug
                }`}>more {talk.attributes.category.data.attributes.category}s</a
            >
        </div>
        <div class="location">
            <a
                class="button"
                href={`${import.meta.env.BASE_URL}/venue/${
                    talk.attributes.room.data.attributes.venue.data.attributes.slug
                }`}>more at the {talk.attributes.room.data.attributes.venue.data.attributes.name}</a
            >
        </div>
    </section>
    <PrevNext prev={prev} next={next} path="talks" />
</BaseLayout>
